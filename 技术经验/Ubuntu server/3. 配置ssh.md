# 技术笔记：Windows 下 SSH Ed25519 免密登录配置实战

## 1. 实验环境

- **客户端**：Windows 10/11 (PowerShell/CMD)
    
- **服务端**：Linux (Ubuntu/CentOS 等)
    
- **密钥算法**：Ed25519（比 RSA 更安全、更短、性能更好）
    

---

## 2. 配置步骤

### 第一步：在 Windows 本地生成密钥对

如果在 `.ssh` 目录下还没有密钥，打开 PowerShell 执行：

PowerShell

```
ssh-keygen -t ed25519 -C "your_email@example.com"
```

- 按三次回车（不设置密码短语）。
    
- 生成位置：`C:\Users\你的用户名\.ssh\`
    
    - `id_ed25519` (私钥，严禁泄露)
        
    - `id_ed25519.pub` (公钥，发给服务器)
        

### 第二步：上传公钥到服务器

在 Windows PowerShell 中执行（替换 `user` 和 `ip`）：

PowerShell

```
type $env:USERPROFILE\.ssh\id_ed25519.pub | ssh user@ip "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### 第三步：服务端权限修正（关键）

SSH 对文件权限极其敏感，权限过大会导致免密失效。登录服务器执行：

Bash

```
# 修正目录权限
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
# 修正家目录权限（不能为777）
chmod 755 ~
```

### 第四步：服务端 SSH 配置检查

编辑配置文件：`sudo nano /etc/ssh/sshd_config`，确保以下项开启：

Plaintext

```
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
```

保存后重启服务：

Bash

```
sudo systemctl restart ssh
```

---

## 3. 进阶优化：配置本地别名

为了避免每次输入 IP，在 Windows 的 `~/.ssh/` 目录下创建 `config` 文件（无后缀）：

Plaintext

```
Host myserver
    HostName 192.168.1.127
    User trlives
    IdentityFile ~/.ssh/id_ed25519
```

**配置后命令：** `ssh myserver` （即可实现自动登录）

---

## 4. 常见问题排查（Troubleshooting）

### Q1：配置了公钥，登录时依然提示输入密码？

- **原因 1：权限不匹配。** 请务必执行第三步的 `chmod` 命令。
    
- **原因 2：公钥格式错误。** 检查 `~/.ssh/authorized_keys`，确保公钥是一整行，没有被编辑器截断。
    
- **原因 3：Windows 客户端未关联私钥。**
    
    - 尝试强制指定私钥登录：`ssh -i ~/.ssh/id_ed25519 user@ip`
        
    - 如果这样能通，请检查 `config` 文件的 `IdentityFile` 路径。
        

### Q2：如何查看具体的报错原因？

使用调试模式连接，查看 SSH 交互过程：

PowerShell

```
ssh -vvv user@ip
```

- 如果看到 `debug1: Skipping quiet password authentication`，说明公钥验证未通过。
    
- 如果看到 `debug1: Authentications that can continue: publickey,password`，说明服务器支持公钥，但拒绝了你当前的这把“钥匙”。
    

### Q3：Root 用户无法免密登录？

如果登录的是 root 账户，需额外检查 `/etc/ssh/sshd_config`：

Plaintext

```
PermitRootLogin yes  # 确保允许 root 登录
```

---

## 5. 总结

**核心公式：** `Windows 生成 Ed25519` -> `PowerShell type 写入` -> `Linux 权限 700/600` -> `Done`。
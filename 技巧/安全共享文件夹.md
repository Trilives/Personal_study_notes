# Windows 与 Ubuntu 安全共享文件夹配置指南

本文档详细说明如何在 **Windows** 和 **Ubuntu Linux** 系统中分别创建安全的共享文件夹，并为每个共享配置专用用户账号，实现最小权限访问控制。两种系统均采用“专用账号 + 密码保护 + 权限隔离”的安全策略，确保共享行为可控、可审计、无越权风险。

---

## 一、通用安全原则

无论使用何种操作系统，安全共享应遵循以下原则：

1. **启用密码保护**：禁止匿名或来宾访问。
2. **使用专用账号**：不复用管理员或日常登录账户。
3. **最小权限分配**：仅授予读取或写入所需权限，避免“完全控制”。
4. **权限双重验证**：
    - Windows：需同时配置“共享权限”和“安全（NTFS）权限”。
    - Ubuntu（Samba）：需配置 Linux 文件系统权限 + Samba 共享权限。
5. **网络隔离**：共享服务默认仅限局域网访问，避免暴露至公网。

---

## 二、Windows 系统配置方法

### 1. 全局网络策略设置

1. 打开 **设置 > 网络和 Internet > 高级网络设置 > 高级共享设置**。
2. 在“所有网络”部分，进行如下配置：
    - 启用网络发现
    - 启用文件和打印机共享
    - **选择“有密码保护的共享”**

> 此设置强制所有共享连接必须提供有效用户名和密码。

### 2. 创建专用本地用户账号

#### 方法 A：图形界面

1. 右键“此电脑” > “管理” > “系统工具 > 本地用户和组 > 用户”。
2. 右键空白区域 > “新用户”。
3. 输入用户名（如 `ShareUser`）和强密码，取消勾选“用户下次登录时须更改密码”。
4. 确保该用户属于 **Users** 组，**不要加入 Administrators**。

#### 方法 B：命令行（推荐）

以管理员身份运行 CMD 或 PowerShell：

```cmd
net user ShareUser SecurePass123 /add
```

- 可省略 `/fullname` 和 `/comment` 参数。
- 账号默认为标准用户，无系统管理权限。

### 3. 配置共享文件夹权限

1. 右键目标文件夹 > “属性” > “共享”选项卡 > “高级共享”。
2. 勾选“共享此文件夹”，点击“权限”。
3. 删除 `Everyone`，点击“添加”，输入专用用户名（如 `ShareUser`）。
4. 分配权限：
    - **只读**：勾选“读取”
    - **读写**：勾选“更改”
5. 切换到“安全”选项卡 > “编辑” > “添加”，同样添加该用户并分配相同或更严格的 NTFS 权限。

> 注意：共享权限与安全权限取交集，建议两者保持一致。

### 4. 客户端访问方式

在其他 Windows 设备上按 `Win + R`，输入：

```
\\<Windows主机IP>
```

例如：`\\192.168.1.100`

系统将弹出认证窗口，输入：

- 用户名：`ShareUser`
- 密码：`SecurePass123`

### 5. 常用管理命令（管理员 CMD）

|功能|命令|
|---|---|
|创建用户|`net user username password /add`|
|删除用户|`net user username /delete`|
|禁用用户|`net user username /active:no`|
|创建共享|`net share name=path /grant:username,permission`|
|查看共享|`net share`|
|删除共享|`net share name /delete`|

---

## 三、Ubuntu 系统配置方法（基于 Samba）

Ubuntu 使用 **Samba** 实现 SMB/CIFS 协议共享，兼容 Windows/macOS/Linux 客户端。

### 1. 安装 Samba

```bash
sudo apt update
sudo apt install samba
```

安装后服务自动启动：`smbd`（主服务）、`nmbd`（NetBIOS 名称解析）。

### 2. 创建专用系统用户（可选但推荐）

创建一个无登录权限的系统用户：

```bash
sudo useradd -r -s /usr/sbin/nologin shareuser
```

- `-r`：创建系统用户（UID < 1000）
- `-s /usr/sbin/nologin`：禁止 shell 登录，仅用于服务

> 该用户无需设置 Linux 登录密码。

### 3. 为 Samba 添加用户并设置密码

Samba 使用独立的用户数据库：

```bash
# 添加并设置 Samba 密码
sudo smbpasswd -a shareuser

# 启用该用户（默认添加后处于禁用状态）
sudo smbpasswd -e shareuser
```

> 此密码用于客户端连接认证，与 Linux 系统密码无关。

### 4. 创建并设置共享目录

```bash
# 创建目录
sudo mkdir -p /srv/shared/projectA

# 设置所有权和权限
sudo chown -R shareuser:shareuser /srv/shared/projectA
sudo chmod -R 0755 /srv/shared/projectA
```

### 5. 配置 Samba 共享（编辑 smb.conf）

```bash
sudo nano /etc/samba/smb.conf
```

在文件末尾添加：

```ini
[ProjectA]
   comment = Shared folder for Project A
   path = /srv/shared/projectA
   valid users = shareuser
   browseable = yes
   writable = yes
   read only = no
   create mask = 0644
   directory mask = 0755
```

#### 关键参数说明：

- `valid users`：**仅允许指定用户访问**，是安全核心。
- `writable = yes`：允许写入。
- `browseable = yes`：在网络邻居中可见。

保存后重启服务：

```bash
sudo systemctl restart smbd nmbd
```

验证配置：

```bash
testparm
```

### 6. 客户端访问方式

- **Windows**：`Win + R` → `\\<Ubuntu_IP>` → 输入用户名 `shareuser` 和 Samba 密码。
- **macOS**：Finder > “前往” > “连接服务器” → `smb://<Ubuntu_IP>`
- **Linux (GNOME)**：文件管理器地址栏输入 `smb://<Ubuntu_IP>/ProjectA`

### 7. 常用管理命令

|功能|命令|
|---|---|
|列出 Samba 用户|`sudo pdbedit -L`|
|删除 Samba 用户|`sudo smbpasswd -x username`|
|禁用 Samba 用户|`sudo smbpasswd -d username`|
|启用 Samba 用户|`sudo smbpasswd -e username`|
|测试本地共享|`smbclient -L localhost -U shareuser`|
|查看服务状态|`sudo systemctl status smbd`|

---

## 四、安全对比与注意事项

|项目|Windows|Ubuntu (Samba)|
|---|---|---|
|共享协议|原生 SMB/CIFS|通过 Samba 实现 SMB/CIFS|
|用户体系|单一本地用户账户|Linux 用户 + Samba 用户（需同步）|
|配置方式|图形界面 + `net` 命令|配置文件 (`/etc/samba/smb.conf`) + 命令行|
|默认行为|可能开启无密码共享（需手动关闭）|默认不共享，需主动配置|
|跨平台兼容性|与 Windows 最佳|与 Windows/macOS/Linux 均兼容|
|权限模型|共享权限 + NTFS 安全权限|Linux 文件权限 + Samba 共享规则|

### 重要安全提醒

- **切勿在公网直接暴露 SMB 端口（TCP 445）**。若需远程访问，应通过 VPN 或 SSH 隧道。
- 定期审查共享列表和用户账号，及时删除不再需要的共享或账号。
- 使用强密码策略，避免使用简单或重复密码。
- 在企业环境中，建议结合防火墙（如 Windows Defender Firewall 或 `ufw`）限制访问源 IP。

---

## 五、总结

Windows 和 Ubuntu 均可实现高安全级别的文件共享，但实现路径不同：

- **Windows** 侧重图形化操作与内置策略，适合桌面环境快速部署。
- **Ubuntu** 依赖 Samba 服务，配置更灵活，适合服务器或长期运行场景。

无论选择哪种系统，核心在于：**专用账号、密码保护、权限最小化、定期维护**。遵循本文档步骤，可有效防止未授权访问，保障数据安全。
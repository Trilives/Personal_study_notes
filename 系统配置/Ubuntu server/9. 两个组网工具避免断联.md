# 远程访问双重保险维护笔记

## 一、 方案架构思路

* **主穿透 (Easytier)**：作为日常主要连接工具，利用其 P2P 穿透能力及灵活的子网配置实现高效访问。
* **备穿透 (Tailscale)**：作为“紧急救生通道”。由于其官方中继服务器（DERP）极高稳定性，当主网卡冲突、配置失效或网络环境突变时，通过 Tailscale 远程接入进行修复。

---

## 二、 关键问题排查（以 Tailscale 为例）

### 1. 执行 `sudo tailscale up` 没反应

* **现象**：命令挂起，不显示登录 URL。
* **原因**：通常是由于开启了其他代理软件的 **TUN（虚拟网卡）模式**，导致路由冲突或握手包被拦截。
* **解决方法**：
1. 暂时关闭代理软件的虚拟网卡/TUN。
2. 重启服务：`sudo systemctl restart tailscaled`。
3. 强制重新认证：`sudo tailscale up --force-reauth`。



### 2. 检查后台服务状态

```bash
# 查看服务是否在运行
sudo systemctl status tailscaled

# 查看实时错误日志（定位 url=false 等网络问题）
journalctl -u tailscaled -f

```

### 3. 网络连通性测试

```bash
# 检查 Tailscale 能否感知外网及中继节点
tailscale netcheck

# 查看当前已连接的对端节点
tailscale status

```

---

## 三、 运维操作流程建议

### 场景 A：当 Easytier 无法连接时

1. 通过 Tailscale IP 登录服务器。
2. 执行 `ip addr` 检查 `et0`（Easytier 网卡）是否分配到 IP。
3. 检查 Easytier 进程：`ps -ef | grep easytier`。
4. 若有冲突，尝试先断开一方，修复后再启动。

### 场景 B：防止虚拟网卡冲突的守则

* **避让原则**：在服务器端进行大规模网络配置变更时，先启动 Tailscale 确保有“保底”路径。
* **代理配置**：若服务器需长期开启代理，建议将 `*.tailscale.com` 和 Easytier 的信令服务器地址加入**直连白名单（Bypass）**，避免路由环路。

---

## 四、 常用命令备忘录

| 命令 | 用途 |
| --- | --- |
| `tailscale login` | 手动获取登录链接 |
| `tailscale logout` | 注销当前节点 |
| `sudo tailscale down` | 停止穿透但不注销 |
| `systemctl restart easytier` | 重启 Easytier 服务（假设已配置 systemd） |

---

**💡 小贴士**：
由于您使用的是 Ubuntu 系统，建议将这两个服务的 `systemd` 状态设置为 `enabled`，确保系统重启后两者都能自动拉起：

```bash
sudo systemctl enable tailscaled
# 同理确保 easytier 的 service 文件也已正确配置并 enable

```
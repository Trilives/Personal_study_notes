以下是一份关于在 Ubuntu 24.04 系统中使用向日葵远程控制软件出现黑屏问题的技术排查与解决经验总结，供后续参考：

---

### 问题现象

在 Ubuntu 24.04 系统上安装向日葵（Sunlogin）客户端后，远程连接可成功建立并显示登录界面，但一旦输入密码进入桌面主界面，画面即变为黑屏。与此同时，使用 ToDesk 可正常显示远程桌面画面。

---

### 根本原因分析

1. **显示协议不兼容**  
    Ubuntu 24.04 默认使用 Wayland 显示协议，而向日葵客户端主要依赖 X11 的底层图形接口进行屏幕捕获。Wayland 对第三方应用的屏幕访问权限进行了严格限制，导致向日葵无法获取桌面画面数据，从而呈现黑屏。
    
2. **服务运行环境缺失**  
    即使手动禁用 Wayland 并切换至 X11 模式，向日葵若未以正确的用户身份（如 gdm）或未加载必要的图形环境变量（如 DISPLAY、XAUTHORITY），仍无法在登录前或登录后正确捕获画面。
    
3. **显示管理器兼容性差异**  
    Ubuntu 默认使用 GDM3（GNOME Display Manager），其对会话管理和安全策略较为复杂，可能干扰向日葵的屏幕抓取逻辑。相比之下，ToDesk 在设计上更主动适配不同显示管理器和协议，具备自动回退或注入机制。
    
4. **软件维护与适配滞后**  
    向日葵在 Linux 桌面端的更新节奏较慢，对 Ubuntu 24.04 新引入的库依赖、安全策略及默认配置缺乏充分测试和适配，而 ToDesk 则表现出更好的兼容性和开箱即用体验。
    

---

### 已尝试的解决方法及结果

|步骤|操作|结果|
|---|---|---|
|1|修改 `/etc/gdm3/custom.conf`，设置 `WaylandEnable=false`，强制使用 X11|系统确认运行于 X11（通过 `$XDG_SESSION_TYPE` 验证），但向日葵仍黑屏|
|2|重新安装最新版向日葵 .deb 包，并修复依赖|安装成功，但黑屏问题未解决|
|3|尝试配置 systemd 预登录服务（以 gdm 用户运行 sunloginclient，设置 DISPLAY 和 XAUTHORITY）|服务可启动，但远程连接后仍为黑屏|
|4|考虑切换显示管理器至 LightDM|因担心界面降级、功能缺失及系统稳定性风险，未实际执行|

---

### 最终解决方案

鉴于向日葵在 Ubuntu 24.04 上存在明显的兼容性问题，且官方未提供稳定可靠的适配方案，**决定放弃使用向日葵，转而采用 ToDesk 作为替代远程控制工具**。ToDesk 在相同环境下可直接正常工作，无需额外配置，满足无人值守远程访问需求。

---

### 经验总结

1. **Ubuntu 24.04 的默认 Wayland 环境对传统远程控制软件构成兼容性挑战**，优先选择明确支持 Wayland 或具备自动 X11 回退机制的软件。
2. **向日葵在 Linux 桌面端的适配能力有限**，尤其在新版本 Ubuntu 上易出现黑屏、依赖缺失等问题，不适合对稳定性要求较高的场景。
3. **ToDesk 在 Linux 平台的兼容性表现更优**，推荐作为 Ubuntu 22.04/24.04 等新版系统的首选远程工具。
4. 若必须使用向日葵，建议在服务器或无 GUI 环境中部署命令行版本，或在旧版 Ubuntu（如 20.04）中使用，以规避图形协议兼容性问题。

---

此文档可作为团队内部技术备忘，避免重复踩坑。